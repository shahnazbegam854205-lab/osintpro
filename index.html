<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<title>âš¡HAPPY ğŸ¤— INFO TOOL âš™ï¸âš¡</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
:root{
  --neon: #00fff2;
  --accent: #00ffaa;
  --warn: #ffb84d;
  --danger: #ff5566;
  --bg: #000;
  --kbd-height: 50vh;
  --safe-bottom: env(safe-area-inset-bottom,12px);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:radial-gradient(circle at center,#070808 0%,#000 80%);font-family:'Share Tech Mono',monospace;color:var(--neon);-webkit-tap-highlight-color:transparent}

/* PREMIUM BADGE */
.premium-badge {
  position: fixed;
  top: 14px;
  right: 14px;
  background: linear-gradient(45deg, #ffd700, #ffed4e);
  color: #000;
  padding: 4px 10px;
  border-radius: 12px;
  font-weight: bold;
  font-size: 11px;
  font-family: 'Share Tech Mono', monospace;
  z-index: 10020;
  box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  border: 1px solid rgba(255, 215, 0, 0.3);
}

.container-wrap{display:flex;justify-content:center;padding:18px 12px;}
.container{
  width:100%;
  max-width:920px;
  background:linear-gradient(180deg, rgba(5,5,6,0.95), rgba(3,3,4,0.95));
  border-radius:16px;
  padding:18px;
  position:relative;
  overflow:visible;
  text-align:center;
  border: 2px solid rgba(0,255,200,0.06);
  box-shadow:0 0 20px rgba(0,255,242,0.3),0 0 40px rgba(0,255,242,0.2),0 0 60px rgba(0,255,242,0.1);
}
.container::before{
  content:'';
  position:absolute;
  inset:-10px;
  border-radius:22px;
  background: linear-gradient(90deg, rgba(0,255,242,0.12), rgba(0,170,170,0.08), rgba(255,170,0,0.06), rgba(255,50,100,0.04) );
  filter: blur(18px);
  opacity:0.8;
  animation: pulseGlow 3s ease-in-out infinite alternate;
  pointer-events:none;
  z-index:0;
}
.container > *{position:relative; z-index:1;}
@keyframes pulseGlow{
  0%{transform:scale(1); opacity:0.5}
  50%{transform:scale(1.04); opacity:1}
  100%{transform:scale(1); opacity:0.5}
}
.header h1{margin:0;font-size:1.4rem;color:var(--neon);text-shadow:0 0 10px var(--neon)}
.header p{color:#bff;margin:6px 0 12px 0;font-size:0.95rem}

/* PROFILE CONTAINER - TOP LEFT */
.profile-container{
  position:fixed;
  top:14px;
  left:14px;
  display:flex;
  align-items:center;
  gap:8px;
  z-index:10010;
}

.profile-container img{
  width:48px;
  height:48px;
  border-radius:50%;
  cursor:pointer;
  object-fit:cover;
  border: 2px solid rgba(255, 215, 0, 0.5);
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.6),
              0 0 30px rgba(255, 215, 0, 0.3);
  animation: goldPulse 2s ease-in-out infinite;
}

.profile-text{
  color:var(--neon); 
  font-size:0.9rem; 
  cursor:pointer;
}

@keyframes goldPulse {
  0%, 100% { 
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.4),
                0 0 20px rgba(255, 215, 0, 0.2);
  }
  50% { 
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.8),
                0 0 40px rgba(255, 215, 0, 0.4);
  }
}

/* YOUTUBE SUBSCRIBE BUTTON */
.youtube-subscribe-container {
  position: fixed;
  bottom: 20px;
  left: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 10010;
}

.youtube-subscribe-btn {
  background: linear-gradient(45deg, #FF0000, #CC0000);
  color: white;
  padding: 10px 16px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 14px;
  cursor: pointer;
  border: none;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
  transition: all 0.3s ease;
}

.youtube-subscribe-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255, 0, 0, 0.4);
}

.youtube-status {
  color: var(--neon);
  font-size: 12px;
  background: rgba(0, 0, 0, 0.7);
  padding: 6px 10px;
  border-radius: 10px;
  border: 1px solid rgba(0, 255, 242, 0.2);
}

/* PROFILE OVERLAY */
.profile-overlay{
  position:fixed; inset:0; background:rgba(0,0,0,0.85); display:none; align-items:center; justify-content:center; z-index:10005;
}
.profile-overlay.open{ display:flex; }
.profile-card{
  width:340px; max-width:90%; border-radius:12px; padding:18px; background:linear-gradient(180deg, rgba(6,6,8,0.95), rgba(4,4,6,0.95)); border:1px solid rgba(0,255,204,0.06);
  box-shadow: 0 20px 70px rgba(0,0,0,0.7), 0 0 40px rgba(0,255,200,0.06);
  text-align:left;
  position:relative;
  max-height: 90vh;
  overflow-y: auto;
}
.profile-head{ display:flex; gap:12px; align-items:center; margin-bottom:8px; }
.hacker-logo{
  width:100px; height:100px;
  background:linear-gradient(180deg,#081213,#001214);
  display:flex;align-items:center;justify-content:center;
  border:1px solid rgba(0,255,200,0.06);
  flex-shrink: 0;
}
.profile-name{ font-size:1.1rem; color:var(--neon); margin:0; }
.profile-meta{ color:#bff; font-size:0.82rem; margin-top:4px; opacity:0.95 }
.profile-list{ margin-top:10px; color:#cfe; font-size:0.9rem; line-height:1.45; }
.profile-list b{ color:var(--accent); }
.profile-close{ 
  position:absolute; 
  right:14px; 
  top:12px; 
  background:var(--danger); 
  color:#fff; 
  border:none; 
  padding:6px 10px; 
  border-radius:8px; 
  cursor:pointer; 
  font-weight:700; 
  font-size: 16px;
  z-index: 10006;
}
a.neon-link{color:#00fff2;text-decoration:underline;animation:blinkLink 2s infinite ease-in-out;}
@keyframes blinkLink{0%,100%{text-shadow:0 0 8px #00fff2;}50%{text-shadow:0 0 16px #00fff2;}}

/* SEARCH INPUT */
#lookupInput{
  width:92%;
  max-width:420px;
  margin:10px auto;
  padding:12px;
  border-radius:12px;
  border:2px solid rgba(0,255,242,0.12);
  background:rgba(0,12,12,0.65);
  color:var(--warn);
  font-size:18px;
  text-align:center;
  outline:none;
  box-shadow: inset 0 -6px 20px rgba(0,0,0,0.4);
}
#lookupInput::placeholder{color:#3fd}
.actions{display:flex;gap:12px;justify-content:center;margin-top:8px;flex-wrap:wrap}
.btn{
  padding:10px 18px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--neon),var(--accent));color:#000;font-weight:700;cursor:pointer;min-width:120px;
  box-shadow: 0 6px 18px rgba(0,255,180,0.06);
}
.btn:disabled {
  background: #666;
  cursor: not-allowed;
}
.btn-secondary {
  background: linear-gradient(90deg, #666, #888);
}
#terminal{
  width:92%;
  max-width:920px;
  margin:16px auto 100px auto;
  background:#000;
  border-radius:12px;
  border:1px solid rgba(0,255,204,0.06);
  padding:12px;
  color:#7CFC00;
  min-height:260px;
  max-height:48vh;
  overflow:auto;
  white-space:pre-wrap;
  font-size:0.9rem;
  box-shadow: 0 8px 30px rgba(0,0,0,0.6);
}
.line { display:block; margin:2px 0; font-family:'Share Tech Mono',monospace; font-size:0.92rem; line-height:1.3; }
.c1{color:#00ffd5}
.c2{color:#ff66ff}
.c3{color:#00ff88}
.c4{color:#ffaa00}
.c5{color:#ff5555}
.terminal-link{color:#00fff2;text-decoration:underline;cursor:pointer;animation:blinkLink 2s infinite ease-in-out;}

/* YouTube Subscription Popup */
.youtube-popup{
  position:fixed; inset:0; background:rgba(0,0,0,0.85); display:none; align-items:center; justify-content:center; z-index:10020;
  backdrop-filter: blur(8px);
}
.youtube-card{
  width:90%;
  max-width:400px;
  background:linear-gradient(180deg, rgba(8,8,12,0.95), rgba(4,4,8,0.95));
  border-radius:16px;
  padding:24px;
  text-align:center;
  border: 2px solid rgba(255,0,0,0.3);
  box-shadow: 0 0 40px rgba(255,0,0,0.4), 0 0 80px rgba(255,0,0,0.2);
  animation: youtubePulse 2s infinite alternate;
}
@keyframes youtubePulse {
  0% { box-shadow: 0 0 30px rgba(255,0,0,0.3), 0 0 60px rgba(255,0,0,0.2); }
  100% { box-shadow: 0 0 50px rgba(255,0,0,0.5), 0 0 100px rgba(255,0,0,0.3); }
}
.youtube-title{
  font-size:1.4rem;
  color:#FF0000;
  margin-bottom:12px;
  text-shadow: 0 0 15px #FF0000;
}
.youtube-message{
  color:#ccf;
  font-size:0.95rem;
  margin-bottom:20px;
  line-height:1.4;
}
.youtube-features{
  text-align:left;
  margin:16px 0;
  padding:0 20px;
}
.youtube-features div{
  margin:8px 0;
  color:#aaf;
  font-size:0.9rem;
}
.youtube-features b{
  color:var(--accent);
}
.youtube-btn{
  padding:12px 30px;
  border-radius:12px;
  border:none;
  background:linear-gradient(90deg, #FF0000, #CC0000);
  color:#fff;
  font-weight:700;
  font-size:1.1rem;
  cursor:pointer;
  margin-top:10px;
  box-shadow: 0 6px 20px rgba(255,0,0,0.4);
  transition: transform 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
.youtube-btn:active{
  transform: scale(0.95);
}

#dialer{
  position:fixed;
  left:0;right:0;bottom:0;
  height:var(--kbd-height);
  max-height:70vh;
  background:linear-gradient(180deg,#020809,#001213);
  border-top:3px solid rgba(0,255,204,0.06);
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;
  padding:12px calc(12px + env(safe-area-inset-left)) calc(var(--safe-bottom) + 12px) calc(12px + env(safe-area-inset-right));
  transform:translateY(100%);transition:transform 240ms cubic-bezier(.2,.9,.3,1);z-index:9999;box-shadow:0 -14px 40px rgba(0,0,0,0.7);
  border-top-left-radius:12px;border-top-right-radius:12px;
}
#dialer.open{transform:translateY(0%)}
#dialer .close{position:absolute;right:12px;top:10px;background:var(--danger);color:#fff;border:none;border-radius:8px;padding:6px 10px;font-weight:700;cursor:pointer}
.drow{display:flex;gap:10px;width:100%;max-width:420px;justify-content:center}
.key{flex:1 0 28%;max-width:110px;height:64px;border-radius:12px;background:linear-gradient(180deg,#002f2f,#003b3b);border:1px solid rgba(0,255,204,0.06);display:flex;align-items:center;justify-content:center;color:var(--neon);font-size:22px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.6);user-select:none}
.key.action{background:linear-gradient(180deg,#003d2c,#00503a);font-size:18}
.key.wide{flex:1 0 62%;max-width:none}

/* MOBILE RESPONSIVE */
@media(max-width:480px){
  .container{margin:8px;padding:14px}
  #lookupInput{font-size:16px;padding:10px}
  .key{height:56px;font-size:20px}
  #terminal{max-height:46vh; margin-bottom: 120px;}
  .profile-container img{width:40px;height:40px}
  .youtube-subscribe-btn { padding: 8px 12px; font-size: 12px; }
  .youtube-status { font-size: 10px; padding: 4px 8px; }
  .youtube-card{padding:18px;}
  .youtube-title{font-size:1.2rem;}
}
</style>
</head>
<body>

<!-- PREMIUM BADGE -->
<div class="premium-badge">YouTube Premium</div>

<!-- YouTube Subscription Popup -->
<div class="youtube-popup" id="youtubePopup">
  <div class="youtube-card">
    <div class="youtube-title">ğŸ¥ SUBSCRIBE TO UNLOCK</div>
    <div class="youtube-message">
      Subscribe to our YouTube channel to unlock all premium OSINT features!
    </div>
    <div class="youtube-features">
      <div><b>ğŸ”</b> Phone Number Lookup</div>
      <div><b>ğŸ†”</b> Aadhaar Data Search</div>
      <div><b>ğŸ—ºï¸</b> Location Mapping</div>
      <div><b>âš¡</b> Fast Data Processing</div>
    </div>
    <button class="youtube-btn" id="connectYouTubeBtn">
      <span>ğŸ“º</span> CONNECT YOUTUBE ACCOUNT
    </button>
    <div style="margin-top:15px; font-size:12px; color:#aaa;">
      We only check your subscription status. No posts or comments.
    </div>
  </div>
</div>

<!-- Profile icon container - TOP LEFT -->
<div class="profile-container">
  <img src="https://media.tenor.com/yWiJcV7p_-wAAAAM/hacker777.gif" id="profileIcon" alt="profile">
  <div class="profile-text" id="profileText">ã€DÌ´eÌ´vÌ´eÌ´lÌ´oÌ´pÌ´eÌ´rÌ´ã€‘</div>
</div>

<!-- YouTube Subscribe Button - BOTTOM LEFT -->
<div class="youtube-subscribe-container" id="youtubeSubscribeContainer">
  <button class="youtube-subscribe-btn" id="youtubeSubscribeBtn">
    <span>ğŸ“º</span> Subscribe
  </button>
  <div class="youtube-status" id="youtubeStatus">Not Verified</div>
</div>

<!-- Profile overlay -->
<div class="profile-overlay" id="profileOverlay">
  <div class="profile-card">
    <button class="profile-close" id="profileClose">Ã—</button>
    <div class="profile-head">
      <div class="hacker-logo">
        <img src="https://media.tenor.com/yWiJcV7p_-wAAAAM/hacker777.gif" style="width:100%;height:100%;object-fit:cover;">
      </div>
      <div>
        <h3 class="profile-name">ğŸ…·ğŸ…°ğŸ…¿ğŸ…¿ğŸ†ˆ ğŸŒŸğŸŒŸğŸŒŸ</h3>
        <div class="profile-meta">â–„ï¸»ãƒ‡HÌ·aÌ·cÌ·kÌ·eÌ·rÌ·â•â•â”ä¸€ vibes â€¢ Focused â€¢ Online</div>
      </div>
    </div>
    <div class="profile-list">
      <div><b>ğ“Šˆğ’†œğŸ” Age:</b> 16ğ’†œğ“Š‰</div>
      <div><b>ğ“Šˆğ’†œâ™‚ï¸ Gender:</b> Maleğ’†œğ“Š‰</div>
      <div><b>ğ“Šˆğ’†œğŸ“š Education:</b> 9th Failğ’†œğ“Š‰</div>
      <div><b>ğ“Šˆğ’†œğŸ  From:</b> earthğ’†œğ“Š‰</div>
      <div><b>ğ“Šˆğ’†œğŸ¤” Interest:</b> Tech & Trickğ’†œğ“Š‰</div>
      <div><b>ğ“Šˆğ’†œâ¤ï¸ Status:</b> Single (Focus On Carier)ğ’†œğ“Š‰</div>
      <div style="margin-top:8px;"><b> ğ“Šˆğ’†œğŸ“Contact:</b>
        <a class="neon-link" href="https://t.me/Royal_smart_boy" target="_blank">@Royal_smart_boyğ’†œğ“Š‰</a>
        <span style="color:#9ff"> â€” Just say Hi!</span>
      </div>
    </div>
  </div>
</div>

<!-- Main UI -->
<div class="container-wrap">
  <div class="container" id="mainContainer">
    <div class="header">
      <h1>âš¡â–„ï¸»ãƒ‡HÌ·AÌ·PÌ·PÌ·YÌ·â•â•â”ä¸€ ğŸ¥°PHONE OR ğŸ†”  TO DATA SEARCH PRO V2.0âš¡</h1>
      <p class="meta">Enter Phone or ğŸ†” get data  </p>
    </div>
    <!-- Search Input -->
    <input id="lookupInput" readonly placeholder="ENTER TARGET PHONE OR ID">
    <div class="actions">
      <button id="lookupBtn" class="btn">Search ğŸ”</button>
      <button id="clearBtn" class="btn">ClearğŸ§¹</button>
    </div>
  </div>
</div>

<div id="terminal" aria-live="polite">
  <div class="line">happy@osint:~$ waiting for new target...</div>
</div>

<!-- Dialer -->
<div id="dialer" aria-hidden="true" role="application" aria-label="Numeric dialer">
  <button class="close" id="closeDialer">Ã—</button>
  <div class="drow"><div class="key">1</div><div class="key">2</div><div class="key">3</div></div>
  <div class="drow"><div class="key">4</div><div class="key">5</div><div class="key">6</div></div>
  <div class="drow"><div class="key">7</div><div class="key">8</div><div class="key">9</div></div>
  <div class="drow"><div class="key action" id="delKey">âŒ«</div><div class="key">0</div><div class="key action" id="enterKey">âœ“</div></div>
</div>

<!-- Background Music -->
<audio id="bgMusic" loop>
    <source src="/autoplaysong.mp3" type="audio/mpeg">
</audio>

<script>
// App State
let featuresUnlocked = false;
let userIdentifier = 'user_' + Math.random().toString(36).substring(2, 9);

// DOM Elements
const youtubePopup = document.getElementById('youtubePopup');
const connectYouTubeBtn = document.getElementById('connectYouTubeBtn');
const youtubeSubscribeBtn = document.getElementById('youtubeSubscribeBtn');
const youtubeStatus = document.getElementById('youtubeStatus');
const youtubeSubscribeContainer = document.getElementById('youtubeSubscribeContainer');
const lookupInput = document.getElementById('lookupInput');
const lookupBtn = document.getElementById('lookupBtn');
const clearBtn = document.getElementById('clearBtn');
const terminal = document.getElementById('terminal');
const dialer = document.getElementById('dialer');
const closeDialer = document.getElementById('closeDialer');

// YouTube Connection Function
async function connectYouTube() {
  try {
    const response = await fetch('/api/youtube-auth');
    const data = await response.json();
    
    if (!data.success) {
      throw new Error(data.message);
    }
    
    // Open YouTube OAuth in popup
    const authWindow = window.open(data.authUrl, 'youtube_auth', 'width=600,height=700');
    
    // Listen for OAuth completion
    const checkAuth = setInterval(() => {
      try {
        // Check if we have success parameters in URL
        const urlParams = new URLSearchParams(window.location.search);
        const youtubeSuccess = urlParams.get('youtube_success');
        const accessToken = urlParams.get('access_token');
        
        if (youtubeSuccess && accessToken) {
          clearInterval(checkAuth);
          verifyYouTubeSubscription(accessToken);
          // Clean URL
          window.history.replaceState({}, document.title, window.location.pathname);
        }
        
        if (authWindow.closed) {
          clearInterval(checkAuth);
        }
      } catch (e) {
        // Cross-origin error - normal
      }
    }, 1000);
    
  } catch (error) {
    console.error('YouTube auth failed:', error);
    alert('YouTube connection failed. Please try again.');
  }
}

// Verify YouTube Subscription
async function verifyYouTubeSubscription(accessToken) {
  try {
    youtubeStatus.textContent = 'â³ Verifying...';
    youtubeStatus.style.color = '#ffaa00';
    
    const response = await fetch('/api/youtube-verify', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        accessToken: accessToken
      })
    });
    
    const result = await response.json();
    
    if (result.success && result.subscribed) {
      // User is subscribed - unlock features
      featuresUnlocked = true;
      youtubePopup.style.display = 'none';
      youtubeStatus.textContent = 'âœ… Verified';
      youtubeStatus.style.color = '#00ff88';
      
      // Update backend about subscription status
      await fetch('/api/search', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          userIdentifier: userIdentifier,
          subscribed: true
        })
      });
      
      // Show success message
      terminal.innerHTML = '';
      await typeLine('happy@osint:~$ YouTube subscription verified! âœ…', 'c3', 8);
      await typeLine('[+] Premium features unlocked', 'c1', 12);
      await typeLine('[+] Thank you for subscribing! ğŸ‰', 'c2', 12);
      
      // Play background music
      const audio = document.getElementById('bgMusic');
      audio.volume = 0.4;
      audio.play().catch(error => {
        console.log('Music play failed:', error);
      });
      
    } else {
      // User not subscribed
      youtubeStatus.textContent = 'âŒ Not Subscribed';
      youtubeStatus.style.color = '#ff5555';
      alert('Please subscribe to our YouTube channel to unlock premium features!');
    }
    
  } catch (error) {
    console.error('YouTube verification failed:', error);
    youtubeStatus.textContent = 'âš ï¸ Check Failed';
    youtubeStatus.style.color = '#ffaa00';
    alert('YouTube verification failed. Please try again.');
  }
}

// Show YouTube popup when user tries to search without subscription
function showYouTubePopup() {
  youtubePopup.style.display = 'flex';
}

// YouTube button events
connectYouTubeBtn.addEventListener('click', connectYouTube);
youtubeSubscribeBtn.addEventListener('click', showYouTubePopup);

// Check URL parameters on load for OAuth callback
window.addEventListener('load', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const youtubeSuccess = urlParams.get('youtube_success');
  const accessToken = urlParams.get('access_token');
  
  if (youtubeSuccess && accessToken) {
    verifyYouTubeSubscription(accessToken);
    // Clean URL
    window.history.replaceState({}, document.title, window.location.pathname);
  }
});

// Developer Profile functionality
const profileOverlay = document.getElementById('profileOverlay');
const profileClose = document.getElementById('profileClose');
const profileIcon = document.getElementById('profileIcon');
const profileText = document.getElementById('profileText');

function openProfile(){
  profileOverlay.classList.add('open');
}
function closeProfile(){
  profileOverlay.classList.remove('open');
}
profileIcon.addEventListener('click', openProfile);
profileText.addEventListener('click', openProfile);
profileClose.addEventListener('click', closeProfile);
profileOverlay.addEventListener('click', e=>{ if(e.target===profileOverlay) closeProfile(); });

// Phone search functionality
let dialerOpen = false;

function lockScroll(){
  const y = window.scrollY || document.documentElement.scrollTop || 0;
  document.documentElement.dataset.prevScroll = y;
  document.documentElement.style.position = 'fixed';
  document.documentElement.style.top = `-${y}px`;
  document.documentElement.style.left = '0';
  document.documentElement.style.right = '0';
}
function unlockScroll(){
  const prev = parseInt(document.documentElement.dataset.prevScroll || '0', 10);
  document.documentElement.style.position = '';
  document.documentElement.style.top = '';
  window.scrollTo(0, prev);
  delete document.documentElement.dataset.prevScroll;
}

function openDialer(){
  if(dialerOpen) return;
  dialer.classList.add('open');
  dialer.setAttribute('aria-hidden','false');
  dialerOpen = true;
  lockScroll();
  const h = dialer.getBoundingClientRect().height;
  document.getElementById('mainContainer').style.marginBottom = (h + 12) + 'px';
  setTimeout(()=>{
    const rect = lookupInput.getBoundingClientRect();
    const viewportHeight = window.innerHeight;
    const desiredTop = Math.max(24, Math.round((viewportHeight - h)/2));
    const diff = rect.top - desiredTop;
    window.scrollBy({top: diff, behavior:'smooth'});
  }, 70);
}
function closeDialerFn(){
  if(!dialerOpen) return;
  dialer.classList.remove('open');
  dialer.setAttribute('aria-hidden','true');
  dialerOpen = false;
  document.getElementById('mainContainer').style.marginBottom = '';
  unlockScroll();
}

lookupInput.addEventListener('click', openDialer);
closeDialer.addEventListener('click', closeDialerFn);

dialer.addEventListener('click', (e)=>{
  const key = e.target.closest('.key');
  if(!key) return;
  if(key.id === 'delKey'){ lookupInput.value = lookupInput.value.slice(0,-1); return; }
  if(key.id === 'enterKey'){ 
    runSequence(); 
    closeDialerFn(); 
    return; 
  }
  const ch = key.textContent.trim();
  if(ch && /^[0-9]$/.test(ch) && lookupInput.value.length < 15) lookupInput.value += ch;
});
document.addEventListener('touchmove', function(e){
  if(dialerOpen && !e.target.closest('#dialer')) e.preventDefault();
},{passive:false});

// Typing effect
function typeLine(text, cls='', speed=16){
  return new Promise(resolve=>{
    const span = document.createElement('span');
    span.className = 'line ' + (cls || '');
    terminal.appendChild(span);
    let i=0;
    function step(){
      if(i < text.length){
        span.textContent += text.charAt(i++);
        terminal.scrollTop = terminal.scrollHeight;
        setTimeout(step, speed + Math.random()*8);
      } else resolve();
    }
    step();
  });
}

function delay(ms){ return new Promise(r=>setTimeout(r, ms)); }

// Function to format address in English
function formatAddressEnglish(address) {
  if (!address) return 'Not Available';
  
  let cleanAddress = address
    .replace(/!!/g, ', ')
    .replace(/!/g, ', ')
    .replace(/\s+/g, ' ')
    .replace(/,+/g, ',')
    .replace(/,\s*,/g, ',')
    .trim();
  
  const segments = cleanAddress.split(',').map(seg => seg.trim()).filter(seg => seg);
  
  return segments.join(', ') || 'Address not available';
}

// Function to create Google Maps link from address
function createMapLink(address) {
  if (!address || address === 'N/A') return null;
  
  const cleanAddress = address
    .replace(/!!/g, ',')
    .replace(/!/g, ',')
    .replace(/\s+/g, ' ')
    .trim();
  
  const encodedAddress = encodeURIComponent(cleanAddress);
  return `https://maps.google.com/?q=${encodedAddress}`;
}

// Data processing function
function processBackendData(fetchedData) {
  const allRecords = [];
  const data = fetchedData.data || fetchedData;
  
  // Process number_info
  if (data.number_info && Array.isArray(data.number_info)) {
    data.number_info.forEach((item) => {
      if (item && item.name) {
        allRecords.push({
          source: 'telecom',
          name: item.name || 'N/A',
          father_name: item.fname || 'N/A',
          address: item.address || 'N/A',
          mobile: item.alt || 'N/A',
          circle: item.circle || 'N/A',
          id_number: item.id || 'N/A',
          type: 'Telecom Data'
        });
      }
    });
  }
  
  // Process ration data
  if (data.ration && Array.isArray(data.ration)) {
    data.ration.forEach((item) => {
      if (item.data && item.data.memberDetailsList && Array.isArray(item.data.memberDetailsList)) {
        item.data.memberDetailsList.forEach((member) => {
          if (member.memberName) {
            allRecords.push({
              source: 'ration',
              name: member.memberName,
              relationship: member.releationship_name || 'N/A',
              address: item.data.address || 'N/A',
              type: 'Ration Card',
              uid: member.uid || 'N/A',
              member_id: member.memberId || 'N/A'
            });
          }
        });
      }
    });
  }
  
  // Process aadhar data
  if (data.aadhar && Array.isArray(data.aadhar)) {
    data.aadhar.forEach((item) => {
      if (item.data && item.data.success && item.data.result && Array.isArray(item.data.result)) {
        item.data.result.forEach((aadharItem) => {
          if (aadharItem.name) {
            allRecords.push({
              source: 'aadhar',
              name: aadharItem.name,
              father_name: aadharItem.father_name || 'N/A',
              address: aadharItem.address || 'N/A',
              mobile: aadharItem.mobile || 'N/A',
              alt_mobile: aadharItem.alt_mobile || 'N/A',
              circle: aadharItem.circle || 'N/A',
              email: aadharItem.email || 'N/A',
              id_number: aadharItem.id_number || 'N/A',
              type: 'Aadhar Linked'
            });
          }
        });
      }
    });
  }
  
  return allRecords;
}

// MAIN SEARCH FUNCTION
async function runSequence(){
  // Check YouTube subscription first
  if (!featuresUnlocked) {
    terminal.innerHTML = '';
    await typeLine('happy@osint:~$ premium features locked!', 'c5', 8);
    await typeLine('[-] YouTube subscription required', 'c5', 12);
    await typeLine('[-] Subscribe to our channel to unlock', 'c5', 12);
    showYouTubePopup();
    return;
  }
  
  const input = (lookupInput.value||'').replace(/\D/g,'').trim();
  if(!input){ 
    await typeLine('[-] Enter number before lookup', 'c5', 12); 
    return; 
  }
  
  terminal.innerHTML='';
  await typeLine(`happy@osint:~$ osint --target ${input}`, '', 8);
  await delay(180);
  await typeLine('[+] initializing connection...', 'c1', 14);
  await delay(180);
  
  let apiUrl, searchType;
  if (input.length === 10) {
    apiUrl = `/api/search?number=${encodeURIComponent(input)}`;
    searchType = 'phone';
    await typeLine('[+] Phone number detected', 'c3', 14);
  } else if (input.length === 12) {
    apiUrl = `/api/search?aadhaar=${encodeURIComponent(input)}`;
    searchType = 'aadhaar';
    await typeLine('[+] Aadhaar number detected', 'c3', 14);
  } else {
    await typeLine('[-] Invalid: Must be 10-digit phone or 12-digit Aadhaar', 'c5', 12);
    return;
  }
  
  await typeLine('telecome compromised', 'c5', 30);
  await delay(140);
  await typeLine('Data requested â€” sending probe', 'c2', 14);
  await delay(140);
  await typeLine('Data extracting...', 'c3', 14);
  await delay(520);
  await typeLine('Extraction successful.', 'c4', 16);
  await delay(160);
  await typeLine('[+] fetching remote data...', 'c1', 12);
  await delay(120);
  
  // API CALL
  try{
    const response = await fetch(apiUrl);
    
    if (!response.ok) {
      if (response.status === 403) {
        await typeLine('[-] YouTube subscription required', 'c5', 18);
        showYouTubePopup();
        return;
      } else if (response.status === 429) {
        await typeLine('[-] Too many requests. Please try again later.', 'c5', 18);
        return;
      } else if (response.status === 503) {
        await typeLine('[-] Service temporarily unavailable. Please try again.', 'c5', 18);
        return;
      } else {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
    }
    
    const result = await response.json();
    
    if (result.success && result.fetched) {
      // Process and display data
      const processedData = processBackendData(result.fetched);
      await displayAllData(input, processedData, result);
    } else {
      await typeLine('[-] No data found for this number', 'c5', 18);
      if (result.message) {
        await typeLine(`[-] ${result.message}`, 'c5', 18);
      }
    }

  }catch(err){
    console.error('API Error:', err);
    await typeLine('[-] API request failed', 'c5', 18);
    await typeLine('[-] Please try again later', 'c5', 18);
  }
}

// Data display function
async function displayAllData(searchInput, processedData, apiResult) {
  if (!processedData || processedData.length === 0) {
    await typeLine('[-] No data records found', 'c5', 18);
    return;
  }

  // Display success message
  await typeLine(`[+] Search Type: ${apiResult.search_type || 'unknown'}`, 'c2', 10);
  await typeLine(`[+] Data sources: ${[...new Set(processedData.map(r => r.source))].join(', ')}`, 'c3', 10);
  await typeLine(`[+] Total Records: ${processedData.length}`, 'c2', 10);
  await typeLine('', '', 4);
  
  // Display data from all sources
  let recordCount = 0;
  
  for (let i = 0; i < processedData.length; i++) {
    const record = processedData[i];
    
    // Skip if no meaningful data
    if (!record.name || record.name === 'N/A') continue;
    
    recordCount++;
    
    await typeLine(`ğŸ“± RECORD ${recordCount} - ${record.source.toUpperCase()}`, 'c2', 8);
    await typeLine(`â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`, 'c3', 6);
    
    // Display common fields
    if (record.name && record.name !== 'N/A') {
      await typeLine(`â”‚ ğŸ‘¤ Name: ${record.name}`, 'c4', 8);
    }
    
    if (record.father_name && record.father_name !== 'N/A') {
      await typeLine(`â”‚ ğŸ‘¨â€ğŸ‘¦ Father: ${record.father_name}`, 'c5', 8);
    }
    
    // Display address
    if (record.address && record.address !== 'N/A') {
      const cleanAddress = formatAddressEnglish(record.address);
      await typeLine(`â”‚ ğŸ  Address: ${cleanAddress}`, 'c1', 8);
    }
    
    // Display mobile numbers
    if (record.mobile && record.mobile !== 'N/A') {
      await typeLine(`â”‚ ğŸ“ Mobile: ${record.mobile}`, 'c3', 8);
    }
    
    if (record.alt_mobile && record.alt_mobile !== 'N/A') {
      await typeLine(`â”‚ ğŸ“± Alt Mobile: ${record.alt_mobile}`, 'c2', 8);
    }
    
    // Display circle/operator
    if (record.circle && record.circle !== 'N/A') {
      await typeLine(`â”‚ ğŸŒ Circle: ${record.circle}`, 'c4', 8);
    }
    
    // Display email
    if (record.email && record.email !== 'N/A') {
      await typeLine(`â”‚ ğŸ“§ Email: ${record.email}`, 'c5', 8);
    }
    
    // Display type
    if (record.type && record.type !== 'N/A') {
      await typeLine(`â”‚ ğŸ“Š Type: ${record.type}`, 'c1', 8);
    }
    
    // Display relationship for family members
    if (record.relationship && record.relationship !== 'N/A') {
      await typeLine(`â”‚ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Relationship: ${record.relationship}`, 'c3', 8);
    }
    
    // Display UID status
    if (record.uid && record.uid !== 'N/A') {
      await typeLine(`â”‚ ğŸ†” UID: ${record.uid}`, 'c2', 8);
    }
    
    await typeLine(`â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€`, 'c3', 6);
    
    // Add Google Maps link
    if (record.address && record.address !== 'N/A') {
      const mapLink = createMapLink(record.address);
      if (mapLink) {
        const mapLine = document.createElement('div');
        mapLine.className = 'line c2';
        mapLine.innerHTML = `ğŸ—ºï¸ <a href="${mapLink}" target="_blank" style="color: #00ff88; text-decoration: underline; cursor: pointer;">MAP LINK LIVE LOCATION</a>`;
        terminal.appendChild(mapLine);
        await delay(100);
      }
    }
    
    await typeLine('', '', 4);
  }
  
  if (recordCount === 0) {
    await typeLine('[-] No valid data records found', 'c5', 18);
    return;
  }
  
  // Footer message
  await typeLine('âœ… OSINT Search Completed Successfully', 'c3', 18);
  await typeLine('', '', 4);
  await typeLine('ğŸ”’ Protect your privacy:', 'c1', 10);
  
  const privacyLine = document.createElement('div');
  privacyLine.className = 'line';
  privacyLine.innerHTML = 'Visit: <a href="https://otpal.vercel.app" target="_blank" style="color: #00fff2; text-decoration: underline; cursor: pointer;">https://otpal.vercel.app</a>';
  terminal.appendChild(privacyLine);
  await delay(100);
  
  await typeLine('', '', 4);
  await typeLine('Developed by Happy ğŸ˜Š', 'c4', 10);
  
  const telegramLine = document.createElement('div');
  telegramLine.className = 'line';
  telegramLine.innerHTML = 'Contact: <a href="https://t.me/Royal_smart_boy" target="_blank" style="color: #ff5555; text-decoration: underline; cursor: pointer;">@Royal_smart_boy</a>';
  terminal.appendChild(telegramLine);
  await delay(100);
}

// Event listeners
lookupBtn.addEventListener('click', ()=>{ 
  if(dialerOpen) closeDialerFn(); 
  runSequence(); 
});

clearBtn.addEventListener('click', ()=>{
  lookupInput.value='';
  terminal.innerHTML='';
  const start=document.createElement('div');
  start.className='line';
  start.textContent='happy@osint:~$ waiting for new target...';
  terminal.appendChild(start);
});

document.addEventListener('keydown',(e)=>{
  if(e.key==='Escape'&&dialerOpen) closeDialerFn();
});

// Initialize
(async()=>{
  await delay(80);
  terminal.innerHTML='';
  const start=document.createElement('div');
  start.className='line';
  start.textContent='happy@osint:~$ waiting for new target...';
  terminal.appendChild(start);
})();
</script>
</body>
</html>
